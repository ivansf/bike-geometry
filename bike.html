<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>

<h2>Bike Geometry</h2>
<div class="container">
	<div style="width: 600px; float: left;">
		<canvas id="bike-render" width="600" height="500">
			Hey!
		</canvas>
	</div>	
	<div style="padding-left: 50px;float: left;">
		<form>
			<label> Zoom Factor
				<input type="number" id="zoomFactor" value="5" onchange="BikeRender()"> 
			</label>
			<br>
			<label> Wheel Size
				<input type="number" id="wheelSize" value="27.5" onchange="BikeRender()"> 
			</label>
			<br>
			<label> Wheel Base
				<input type="number" id="wheelBase" value="43.5" onchange="BikeRender()"> 
			</label>
			<br>
			<label> Chainstay
				<input type="number" id="chainStay" value="0" onchange="BikeRender()"> 
			</label>
			<br>
			<label> Bottom Bracket Height
				<input type="number" id="bbHeight" value="12" onchange="BikeRender()"> 
			</label>
			<br>
			<label> Seat Tube Length
				<input type="number" id="seatTube" value="19" onchange="BikeRender()"> 
			</label>
			<br>
			<label> standOverHeight
				<input type="number" id="standOverHeight" value="0" onchange="BikeRender()"> 
			</label>
			<br>
			<label> seatAngle
				<input type="number" id="seatAngle" value="73" onchange="BikeRender()"> 
			</label>
			<br>
			<label> headAngle
				<input type="number" id="headAngle" value="71" onchange="BikeRender()"> 
			</label>
			<br>
			<label> forkLength
				<input type="number" id="forkLength" value="16" onchange="BikeRender()"> 
			</label>
			<br>
			<label> topTube
				<input type="number" id="topTube" value="0" onchange="BikeRender()"> 
			</label>
		</form>
	</div>	
</div>

<script type="text/javascript">



var Bike = (function Bike() {

	// Initial Setup
	// -------------
	
	var name, wheelSize, forkLength, wheelBase, chainStay, bbHeight, seatTube, standOverHeight, seatAngle,
		headAngle, topTube, name;
	var leftSpace = 150;
	var ground = 350;

	// Checks for required numbers to be present.
	// ------------------------------------------
	var requiredParts = function() {

		var valid = false;
		name.length > 0 ? valid = true : valid = false;
		// console.log(wheelSize);
		wheelSize ? valid = true : valid = false;
		// this.seatAngle > 0 ? valid = true : valid = false;
		// this.separation > 0 ? valid = true : valid = false; 
		// this.separation = 100;

		//throw "Missing separation";
		return valid;
	}

	// Renders a guide grid
	// --------------------
	var	renderGridCanvas = function(ctx) { 
		ctx.beginPath();
		ctx.strokeStyle = "rgb(120,120,120)";
		ctx.lineWidth = 0.5;
		for (var i = 0; i <= 600; i+=10) {
			ctx.moveTo(i * this.zoomFactor,0);
			ctx.lineTo(i * this.zoomFactor, 410);
		};
    	ctx.stroke();

    	ctx.beginPath();
    	ctx.moveTo(0, ground);
    	ctx.lineTo(600, ground);
    	ctx.strokeStyle = "rgb(120,120,120)";
    	ctx.lineWidth = 0.5;
    	ctx.stroke();

    	return;
	}







	// ---------------------------------
	// Helpers and position calculations
	// ---------------------------------

	var bbPosition = function (ground) {
		// x should be calculated using the chainstay

		// TODO: Properly calculate BB position based on chainstay length using 1 point and an arc.
		return {
				x: leftSpace + wheelBase/2 * zoomFactor,
				y: (ground - (bbHeight * zoomFactor))
			}; // random number for now
	}


	// Public Methods
	// --------------
	// 	

	// setValues()
	// 		should be called if the geometry has to be passed before it gets
	// 		rendered. This can be helpful when we just need calculations.

	return {

		setValues : function(values) {
			name = values.name;
			zoomFactor = values.zoomFactor;
			wheelSize = values.wheelSize;
			wheelBase = values.wheelBase;
			chainStay = values.chainStay;
			bbHeight = values.bbHeight;
			seatTube = values.seatTube;
			standOverHe = values.standOverHeight;
			seatAngle = values.seatAngle;
			headAngle = values.headAngle;
			topTube = values.topTube;
			forkLength = values.forkLength;
		},

		/**
			Renders the bike using regular Canvas.
		*/
		renderCanvas : function(canvasElement, renderGrid) {
			canvas = document.getElementById(canvasElement);
			var ctx = canvas.getContext('2d');
			ctx.clearRect(0, 0, canvas.width, canvas.height);

			// console.log(ctx);
			if (!requiredParts())  {
				console.log('Missing parts');
				return;
			}

			// var base = 250;
			
			

			if (renderGrid)
				renderGridCanvas(ctx);


	  		// drawing wheels
			ctx.strokeStyle = "rgb(140,140,140)";
			ctx.lineWidth = 2 * zoomFactor;
			

			ctx.beginPath();
			ctx.arc(leftSpace, ground - (wheelSize * zoomFactor/2), wheelSize/2 * zoomFactor, 0 ,Math.PI*2, true);
			ctx.stroke();

			ctx.beginPath();
			ctx.arc(leftSpace + wheelBase * zoomFactor,  ground - (wheelSize * zoomFactor/2), wheelSize/2* zoomFactor, 0 ,Math.PI*2, true);
			ctx.stroke();

			ctx.strokeStyle = "rgb(50, 50, 50)";

			// inner wheels
			// ctx.lineWidth = 1;
			// ctx.beginPath();
			// ctx.arc(leftSpace + wheelBase * zoomFactor,  ground - (wheelSize * zoomFactor/2), (wheelSize/2 * 0.9) * zoomFactor, 0 ,Math.PI*2, true);
			// ctx.stroke();

			// ctx.lineWidth = 1;
			// ctx.beginPath();
			// ctx.arc(leftSpace,  ground - (wheelSize * zoomFactor/2), (wheelSize * 0.9) * zoomFactor/2, 0 ,Math.PI*2, true);
			// ctx.stroke();


			// bottom bracket
			ctx.lineWidth = zoomFactor;
			ctx.beginPath();
			ctx.arc(bbPosition(ground).x, bbPosition(ground).y, 1 * zoomFactor, 0 ,Math.PI*2, true);
			ctx.stroke();


			// seat tube
			angle = 270 - seatAngle;
			angle = angle * Math.PI / 180;
			endX = bbPosition(ground).x + (seatTube * zoomFactor) * Math.sin(angle);
			endY = bbPosition(ground).y + (seatTube * zoomFactor) * Math.cos(angle);
			ctx.lineWidth = 1 * zoomFactor;
			ctx.beginPath();
			ctx.moveTo(bbPosition(ground).x, bbPosition(ground).y);
			ctx.lineTo(endX, endY); 
			ctx.stroke();


			//chainstay
			ctx.beginPath();
			ctx.moveTo(bbPosition(ground).x, bbPosition(ground).y); // this should the center of the BB.
			ctx.lineTo(leftSpace, ground - (wheelSize * zoomFactor/2)); 
			ctx.stroke();

			// fork
			angle = 270 - headAngle;
			angle = angle * Math.PI / 180;
			forkTopX = leftSpace + wheelBase * zoomFactor + (forkLength * zoomFactor) * Math.sin(angle);
			forkTopY = ground - (wheelSize * zoomFactor/2) + (forkLength * zoomFactor) * Math.cos(angle);
			ctx.lineWidth = 1 * zoomFactor;
			ctx.beginPath();
			ctx.moveTo(leftSpace + wheelBase * zoomFactor, ground - (wheelSize * zoomFactor/2));
			ctx.lineTo(forkTopX, forkTopY);
			ctx.stroke();

			// Head Tube
			// Using the end of the fork (top coordinates)
			angle = 270 - headAngle;
			angle = angle * Math.PI / 180;
			endX = forkTopX + (5 * zoomFactor) * Math.sin(angle);
			endY = forkTopY + (5 * zoomFactor) * Math.cos(angle);
			ctx.lineWidth = 2 * zoomFactor;
			ctx.beginPath();
			ctx.moveTo(forkTopX, forkTopY);
			ctx.lineTo(endX, endY); 
			ctx.stroke();



		},

	}
})();


values = {
	name : "My Bike",
	zoomFactor : 5,
	wheelSize : 27.5,
	wheelBase: 43.5,
	chainStay : 0,
	bbHeight : 12,
	seatTube : 19,
	standOverHeight : 0,
	seatAngle : 73,
	headAngle : 71,
	forkLength : 16,
	topTube: 0
}

Bike.setValues(values);
Bike.renderCanvas("bike-render", true);

</script>

<script type="text/javascript">
	
	BikeRender = function () {
		values.zoomFactor  = document.getElementById('zoomFactor').value;
		values.wheelSize  = document.getElementById('wheelSize').value;
		values.wheelBase  = document.getElementById('wheelBase').value;
		values.chainStay  = document.getElementById('chainStay').value;
		values.bbHeight  = document.getElementById('bbHeight').value;
		values.seatTube  = document.getElementById('seatTube').value;
		values.standOverHeight  = document.getElementById('standOverHeight').value;
		values.seatAngle  = document.getElementById('seatAngle').value;
		values.headAngle  = document.getElementById('headAngle').value;
		values.forkLength  = document.getElementById('forkLength').value;
		values.topTube  = document.getElementById('topTube').value;
		Bike.setValues(values);
		Bike.renderCanvas("bike-render", true);
	}

</script>




</body>
</html>